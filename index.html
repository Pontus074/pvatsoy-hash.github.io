<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Pingis üèì - Niv√•er & Hinder</title>
<style>
body {margin:0;font-family:Arial;background:#222;color:white;text-align:center;}
header{background:#111;padding:15px;}
#gameCanvas{background:#2c3e50;display:block;margin:20px auto;border:4px solid #ecf0f1;border-radius:10px;touch-action:none;}
#menu,#gameOverScreen{display:none;margin-top:30px;}
button{background:#1abc9c;border:none;padding:12px 25px;margin:10px;color:white;font-size:16px;border-radius:5px;cursor:pointer;}
button:hover{background:#16a085;}
</style>
</head>
<body>
<header><h1>üèì Pingis üèì</h1></header>
<canvas id="gameCanvas" width="700" height="400"></canvas>

<div id="menu">
  <h2>V√§lkommen!</h2>
  <p>Flytta racketen med mus, piltangenter eller finger p√• mobilen.</p>
  <button onclick="startGame()">Starta spelet</button>
</div>

<div id="gameOverScreen">
  <h2>Game Over!</h2>
  <p id="finalScore"></p>
  <button onclick="startGame()">Starta om</button>
  <button onclick="goHome()">Till start</button>
</div>

<script>
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");

let player={x:20,y:canvas.height/2-40,width:10,height:80};
let ai={x:canvas.width-30,y:canvas.height/2-40,width:10,height:80};
let ball,score,lives,level,speed,aiSpeed;
let playing=false;
let targetY=player.y;
let keyUp=false,keyDown=false;
let obstacles=[];

function resetBall(){
  // Starta l√•ngsammare
  let startSpeed = Math.max(2, speed*0.6); 
  ball={
    x:canvas.width/2,
    y:canvas.height/2,
    radius:8,
    speedX:startSpeed*(Math.random()>0.5?1:-1),
    speedY:startSpeed*(Math.random()>0.5?1:-1)
  };
}

function startGame(){
  score=0; lives=3; level=1;
  speed=3; aiSpeed=2.5;
  obstacles=[];
  playing=true;
  document.getElementById("menu").style.display="none";
  document.getElementById("gameOverScreen").style.display="none";
  resetBall();
  gameLoop();
}

function goHome(){
  document.getElementById("menu").style.display="block";
  document.getElementById("gameOverScreen").style.display="none";
  ctx.clearRect(0,0,canvas.width,canvas.height);
}

function gameOver(){
  playing=false;
  document.getElementById("finalScore").textContent="Din po√§ng: "+score+" | Niv√•: "+level;
  document.getElementById("gameOverScreen").style.display="block";
}

function updatePlayer(){
  if(keyUp) targetY-=6;
  if(keyDown) targetY+=6;
  player.y+=(targetY-player.y)*0.2;
  player.y=Math.max(0,Math.min(canvas.height-player.height,player.y));
}

function addObstacles(){
  obstacles=[];
  for(let i=0;i<level-1;i++){
    let obsX=Math.random()*(canvas.width*0.6)+canvas.width*0.2;
    let obsY=Math.random()*(canvas.height-30);
    obstacles.push({x:obsX,y:obsY,width:15,height:50});
  }
}

function gameLoop(){
  if(!playing) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Rita hinder
  ctx.fillStyle="red";
  obstacles.forEach(o=>ctx.fillRect(o.x,o.y,o.width,o.height));

  // Rita spelplan
  ctx.fillStyle="white";
  ctx.fillRect(player.x,player.y,player.width,player.height);
  ctx.fillRect(ai.x,ai.y,ai.width,ai.height);
  ctx.beginPath();
  ctx.arc(ball.x,ball.y,ball.radius,0,Math.PI*2);
  ctx.fill();

  ctx.font="16px Arial";
  ctx.fillText("Po√§ng: "+score,20,20);
  ctx.fillText("Liv: "+lives,20,40);
  ctx.fillText("Niv√•: "+level,20,60);

  updatePlayer();

  // Bollr√∂relse
  ball.x+=ball.speedX;
  ball.y+=ball.speedY;

  // Studsa p√• topp & botten
  if(ball.y-ball.radius<0||ball.y+ball.radius>canvas.height) ball.speedY*=-1;

  // Spelare-kollision
  if(ball.x-ball.radius<player.x+player.width && ball.y>player.y && ball.y<player.y+player.height){
    ball.speedX*=-1;
    score++;
    // Accelerera gradvis
    if(score%5===0){ speed+=0.3; aiSpeed+=0.2; }
    // Niv√•progression
    if(score%8===0){
      level=Math.min(10,level+1);
      addObstacles();
    }
  }

  // AI-kollision
  if(ball.x+ball.radius>ai.x && ball.y>ai.y && ball.y<ai.y+ai.height){
    ball.speedX*=-1;
  }

  // AI r√∂relse
  if(ball.y<ai.y+ai.height/2) ai.y-=aiSpeed;
  else ai.y+=aiSpeed;
  ai.y=Math.max(0,Math.min(canvas.height-ai.height,ai.y));

  // Krock med hinder
  obstacles.forEach((o,i)=>{
    if(ball.x+ball.radius>o.x && ball.x-ball.radius<o.x+o.width &&
       ball.y+ball.radius>o.y && ball.y-ball.radius<o.y+o.height){
      ball.speedX*=-1;
      obstacles.splice(i,1); // Hindret f√∂rsvinner
    }
  });

  // Miss ‚Äì spelaren f√∂rlorar liv
  if(ball.x-ball.radius<0){ lives--; if(lives<=0){ gameOver(); return; } else{ resetBall(); } }

  // AI missar
  if(ball.x+ball.radius>canvas.width){ score++; resetBall(); }

  requestAnimationFrame(gameLoop);
}

// Muskontroll
canvas.addEventListener("mousemove",e=>{
  let rect=canvas.getBoundingClientRect();
  targetY=e.clientY-rect.top-player.height/2;
});

// Tangentbord
document.addEventListener("keydown",e=>{if(e.key==="ArrowUp") keyUp=true; if(e.key==="ArrowDown") keyDown=true;});
document.addEventListener("keyup",e=>{if(e.key==="ArrowUp") keyUp=false; if(e.key==="ArrowDown") keyDown=false;});

// Touch
canvas.addEventListener("touchmove",e=>{
  let rect=canvas.getBoundingClientRect();
  let touchY=e.touches[0].clientY-rect.top;
  targetY=touchY-player.height/2;
});

goHome();
</script>
</body>
</html>
